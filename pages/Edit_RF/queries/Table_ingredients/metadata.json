{
  "gitSyncId": "683e21591b989748a426a418_a575a8b2-4110-4017-98b8-e251a2023f15",
  "id": "Edit_RF_Table_ingredients",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n  crf.id_composant,\n  crf.quantite_unite,\n  crf.id_unite,\n  u.nom_unite,\n  u.type_unite,\n\n  -- Nom and type composant\n  CASE \n    WHEN crf.id_matiere_premiere IS NOT NULL THEN mp.nom\n    ELSE sr.nom\n  END AS nom_composant,\n\n  CASE \n    WHEN crf.id_matiere_premiere IS NOT NULL THEN 'matiere'\n    ELSE 'sous_recette'\n  END AS type_composant,\n\n  -- Prix matière première\n  mp.prix_achat_ht,\n\n  -- Quantité unitaire (si matière première)\n  mp.quantite_unite AS quantite_unitaire,\n\n  -- Coût unitaire (calculé)\n  CASE \n    WHEN crf.id_matiere_premiere IS NOT NULL AND mp.quantite_unite > 0 THEN ROUND(mp.prix_achat_ht / mp.quantite_unite, 5)\n    ELSE NULL\n  END AS cout_unitaire,\n\n  -- Coût total (calculé)\n  CASE \n    WHEN crf.id_matiere_premiere IS NOT NULL AND mp.quantite_unite > 0 THEN \n      ROUND((mp.prix_achat_ht / mp.quantite_unite) * crf.quantite_unite, 5)\n    ELSE \n      ROUND(v.cout_total / NULLIF(v.quantite_produite, 0) * crf.quantite_unite, 5)\n  END AS cout_total\n\nFROM newroseclaire.composants_recettes_finales crf\nLEFT JOIN newroseclaire.matieres_premieres mp ON crf.id_matiere_premiere = mp.id_matiere_premiere\nLEFT JOIN newroseclaire.sous_recettes sr ON crf.id_sous_recette = sr.id_sous_recette\nLEFT JOIN newroseclaire.vue_cout_sous_recette v ON crf.id_sous_recette = v.id_sous_recette\nLEFT JOIN newroseclaire.unites u ON crf.id_unite = u.id_unite\nWHERE crf.id_recette_finale = {{ appsmith.URL.queryParams.recetteId }}\nORDER BY type_composant\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "roseclaire database",
      "isAutoGenerated": false,
      "name": "roseclaire database",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "Table_ingredients",
    "pageId": "Edit_RF",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": false
  }
}